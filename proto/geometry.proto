syntax = "proto3";

package gks.geometry;

import "common.proto";

option java_multiple_files = true;
option java_package = "gks.geometry";

// =============================================================================
// 几何类型与参数（L3，依赖 common）
// =============================================================================

// 直线参数：起点、终点
message LineParams {
  gks.common.Point2 start = 1;
  gks.common.Point2 end = 2;
}

// 圆弧参数：圆心、半径、起始角、终止角（弧度）
message ArcParams {
  gks.common.Point2 center = 1;
  double radius = 2;
  double start_angle = 3;
  double end_angle = 4;
}

// 圆参数：圆心、半径
message CircleParams {
  gks.common.Point2 center = 1;
  double radius = 2;
}

// 多段线单段：直线（起点 = 上一段终点；首段起点 = 多段线 start）
message LineSegment {
  gks.common.Point2 end = 1;
}

// 多段线单段：圆弧（起点 = 上一段终点；终点 = center + radius*(cos(end_angle), sin(end_angle))）
message ArcSegment {
  gks.common.Point2 center = 1;
  double radius = 2;
  double end_angle = 3;   // 弧度
  bool clockwise = 4;     // 顺/逆时针方向
}

// 多段线一段（直线或圆弧），可选指定段末拐点过渡方式
message PolylineSegment {
  oneof segment {
    LineSegment line = 1;
    ArcSegment arc = 2;
  }
  // 本段终点处的拐点过渡方式；省略则使用多段线 default_corner_transition
  gks.common.CornerTransition corner_after = 3;
}

// 多段线参数：起点 + 段序列；拐点 = 段与段连接处，由段几何唯一确定
message PolylineParams {
  gks.common.Point2 start = 1;
  repeated PolylineSegment segments = 2;
  // 未在 segment.corner_after 覆盖的拐点均按此方式；默认锐棱
  gks.common.CornerTransition default_corner_transition = 3;
}

// 几何图元（可被多个 WorkFeature 引用，共边通过共享实现）
message WorkGeometry {
  string id = 1;
  gks.common.GeometryType type = 2;
  oneof parameters {
    LineParams line = 3;
    ArcParams arc = 4;
    CircleParams circle = 5;
    PolylineParams polyline = 6;
  }
}
